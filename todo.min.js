var ToDo=function(){var e=this;table=document.getElementsByClassName("t")[0],tableHead=document.createElement("thead"),header=tableHead.insertRow(0),tableBody=document.createElement("tbody"),tableFoot=document.createElement("tfoot"),footer=tableFoot.insertRow(0),add=document.createElement("button"),download=document.createElement("button"),table.appendChild(tableHead),table.appendChild(tableFoot),header.innerHTML='<th><!-- spacer --></th><th>Task</th><th>Description</th><th>Time</th><th><button class="add">+</button></th>',footer.innerHTML='<td colspan="5"></td>',footer=footer.firstChild,this.loadTasks(tableBody);var t=document.createElement("button");t.innerHTML="Remove Completed",t.id="removeComplete",footer.appendChild(t),new Trigger(t,"click",function(){for(var t in e.tasks)if(e.tasks.hasOwnProperty(t)&&1==e.tasks[t].complete){var a=JSON.parse(localStorage.tTasks);delete a[t],localStorage.tTasks=JSON.stringify(a),window.location.reload()}}),new Trigger(header.lastChild.children[0],"click",function(){e.addTask(e,tableBody)}),table.appendChild(tableBody)};ToDo.prototype.addTask=function(e,t,a){var n=function(a){e.tasks[a.uuid]=a,e.renderTask(t,a),e.saveTasks()};if(null!==a&&"object"==typeof a){var d={};d.uuid=a.uuid,d.name=a.name,d.time=a.time,d.desc=a.desc,d.complete=a.complete,n(d)}else{var d=new Task;d.m(d,function(){n(d)})}},ToDo.prototype.saveTasks=function(){localStorage.setItem("tTasks",JSON.stringify(this.tasks))},ToDo.prototype.loadTasks=function(e){e.innerHTML="";var t=JSON.parse(localStorage.getItem("tTasks"));if(null!==t&&"object"==typeof t){this.tasks=t;var a=this.tasks;for(var n in this.tasks)a.hasOwnProperty(n)&&this.addTask(this,e,a[n])}else null!==t&&"object"!==t?(delete localStorage.tTasks,this.tasks={}):this.tasks={}},ToDo.prototype.renderTask=function(e,t){var a=document.createElement("tr"),n=new Date(Date.parse(t.time)+6e4*(new Date).getTimezoneOffset()),d=n.toString().substring(0,16),o=n.toString().substring(17,18),c=n.toString().substring(19,21);if(o>12){o-=12;var i=" AM"}else var i=" PM";n=d+o+":"+c+i,a.innerHTML="<td></td><td>"+t.name+"</td><td><i>"+t.desc+"</i></td><td>"+n+"</td><td></td>",check=document.createElement("input"),check.type="checkbox",check.id=t.uuid,a.lastChild.appendChild(check),e.appendChild(a),1==t.complete&&(a.className="complete",check.checked="checked");var l=this;new Trigger(check,"click",function(){t.complete^=!0,a.className=1==t.complete?"complete":"",l.saveTasks()})};var Task=function(){this.uuid=(65536*(1+Math.random())|0).toString(16).substring(1),this.name="",this.time="",this.desc="",this.complete=0};Task.prototype.m=function(e,t){var a=document.createElement("div"),n=document.createElement("div"),d=document.createElement("table"),o=document.createElement("tr"),c=document.createElement("tr"),i=document.createElement("tr"),l=document.createElement("tr"),r=document.createElement("button"),s=document.createElement("button"),m=document.createElement("input"),p=document.createElement("input"),h=document.createElement("textarea");a.className="s",a.appendChild(n),n.className="tm",n.appendChild(d),o.innerHTML='<th colspan="2">New Task</th>',d.appendChild(o),c.innerHTML="<td></td><td></td>",d.appendChild(c),c.children[0].appendChild(m),m.type="text",m.placeholder="Task Name",m.id="taskName",c.children[1].appendChild(p),p.type="datetime-local",p.placeholder="Task Time",p.id="taskTime",i.innerHTML='<td colspan="2"></td>',d.appendChild(i),i.children[0].appendChild(h),h.placeholder="Description",h.id="taskDesc",l.innerHTML='<td colspan="2"></td>',d.appendChild(l),r.innerHTML="Add",s.innerHTML="Cancel",l.children[0].appendChild(r),l.children[0].appendChild(s),new Trigger(s,"click",function(){a.parentNode.removeChild(a)}),new Trigger(r,"click",function(){e.name=document.getElementById("taskName").value,e.time=document.getElementById("taskTime").value,e.desc=document.getElementById("taskDesc").value,a.parentNode.removeChild(a),t.call()}),document.children[0].appendChild(a)};var Trigger=function(e,t,a){e.addEventListener?e.addEventListener(t,a,!0):e.attachEvent&&e.attachEvent("on"+t,a)};
